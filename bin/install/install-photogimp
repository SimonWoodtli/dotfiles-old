#!/bin/sh
read -p "Only run this script if you installed Gimp via Flatpak. [y/n]" input
case $input in
  y|Y) echo "Preparing" ;;
  n|N) exit 1 ;;
  *) echo 'Invalid input only "y n" accepted.'
esac
## create variable for your system
spruce_type=Flatpak

## get correct link with jq
URL=$(curl -s https://api.github.com/repos/Diolinux/PhotoGIMP/releases/latest | jq -r ".assets[] | select(.name | test(\"${spruce_type}\")) | .browser_download_url")

## download zip
echo "Downloading $URL"
curl -sL "$URL" -o "/tmp/${URL##*/}"

## unzipping
echo "Installing /tmp/${URL##*/}"
unzip "/tmp/${URL##*/}" -d /tmp

## Problem the unzipped folder doesn't have .zip ending in it's name.
## Parameter Expansion can only be applied to either the beginning or the
## end of a variable but not both at the same time. You could youse some
## regex but that requires [[]]
## example: [[ $foo =~ ^[.]([^.]+) ]] && echo ${BASH_REMATCH[1]}
## Hence at least one reassignment of the variable is needed
## remove .zip
URL="${URL%.*}"
## remove path to file
#URL="${URL##*/}

## moving files
rm -rf $HOME/.var/app/org.gimp.GIMP/
cp -rf /tmp/"${URL##*/}"/.var/app/org.gimp.GIMP/ $HOME/.var/app/
cp -rf /tmp/"${URL##*/}"/.local/share/icons/* $HOME/.local/share/icons/
cp -rf /tmp/"${URL##*/}"/.local/share/applications/* $HOME/.local/share/applications/
