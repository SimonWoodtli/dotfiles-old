#!/bin/bash
profilename="test"
dir="$HOME/.mozilla/firefox/$profilename-profile"
## Install Dependencies
#sudo apt install xdotool

## Create Profile
## TODO for some odd reason `firefox -CreateProfile stopped working fix it
firefox -CreateProfile "$profilename $HOME/.mozilla/firefox/$profilename-profile"
cd $dir && ls
exit 1

echo "created profile"
## Launch Firefox to initialize profile
firefox -P $profilename &
sleep 10
echo "start firefox"

## Quit Firefox
## Get Firefox ID
WID=`xdotool search "Mozilla Firefox" | head -1`
## Activate Window with Firefox ID
xdotool windowactivate --sync $WID
## Quit Firefox Window
xdotool key --clearmodifiers alt+q
sleep 3
echo "quit firefox"

## Remove profile files
[[ ! -d $dir ]] && exit 9 || rm -rf $dir/*

## Copy files
## TODO test if this works, but need to fix other issue first
read -p "Do you want to setup regular Firefox or Whonix? [1-2]
1) Regular Firefox
2) Whonix
"
case $REPLY in
  1) cp -r $DOTFILES/bin/firefox/ffprofile/* $dir ;;
  2) cp $DOTFILES/bin/firefox/whonixprofile/prefs.js $dir/prefs.js ;;
  *) echo "Only 1 and 2 are valid inputs" && exit 2 ;;
esac
## TODO after setting up everyting you still need to go to
## "about:profiles" and make sure your privacy profile is used by
## starting it. "about:support" contains profile folders
